@inject IJSRuntime JS
@inject LabelService Labels

@{
    var label = Label ?? Labels.GetLabel(Address ?? "");
    var display = GetDisplayText();
}

<span class="mono small" title="@Address">@if (label != null)
    {<span class="address-label">@label</span><span class="text-muted"> (@display)</span>}
    else
    {@display}@if (ShowCopy && !string.IsNullOrEmpty(Address))
    {<button class="btn btn-link btn-sm p-0 ms-1 address-copy-btn"
             @onclick="CopyAddress" @onclick:stopPropagation="true"
             title="Copy full address"><i class="bi @(_copied ? "bi-check-lg text-success" : "bi-clipboard")"></i></button>}</span>

@code {
    private bool _copied;

    /// <summary>Full 60-character identity string.</summary>
    [Parameter] public string? Address { get; set; }

    /// <summary>Optional explicit label (overrides LabelService lookup).</summary>
    [Parameter] public string? Label { get; set; }

    /// <summary>Number of chars to show at start and end when truncating. Default: 8.</summary>
    [Parameter] public int TruncateChars { get; set; } = 8;

    /// <summary>Whether to show the copy button. Default: true.</summary>
    [Parameter] public bool ShowCopy { get; set; } = true;

    /// <summary>Whether to show the full address without truncation.</summary>
    [Parameter] public bool ShowFull { get; set; }

    private string GetDisplayText()
    {
        if (string.IsNullOrEmpty(Address)) return "";
        if (ShowFull || Address.Length <= TruncateChars * 2 + 3) return Address;
        return $"{Address[..TruncateChars]}...{Address[^TruncateChars..]}";
    }

    private async Task CopyAddress()
    {
        if (string.IsNullOrEmpty(Address)) return;
        await JS.InvokeVoidAsync("navigator.clipboard.writeText", Address);
        _copied = true;
        StateHasChanged();
        await Task.Delay(2000);
        _copied = false;
    }
}
