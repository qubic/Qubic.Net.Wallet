@inject QubicBackendService Backend
@inject SeedSessionService Seed
@inject NavigationManager Nav
@implements IDisposable

<div class="qb-sidebar p-2">
    <nav class="nav flex-column">
        <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">
            <i class="bi bi-house me-2"></i>Home
        </NavLink>

        @* ── SEND & RECEIVE ── *@
        <div class="nav-section-header mt-2">
            <span class="nav-section-label">TRANSACTIONS</span>
        </div>
        @if (Seed.HasSeed)
        {
            <NavLink class="nav-link" href="/send">
                <i class="bi bi-send me-2"></i>Send
            </NavLink>
            <NavLink class="nav-link" href="/send-many">
                <i class="bi bi-send-plus me-2"></i>Send to Many
            </NavLink>
            <NavLink class="nav-link" href="/receive">
                <i class="bi bi-qr-code me-2"></i>Receive
            </NavLink>
        }
        else
        {
            <span class="nav-link text-muted small" title="Unlock seed to enable">
                <i class="bi bi-lock me-2"></i>Unlock to send
            </span>
        }

        @* ── ASSETS ── *@
        <div class="nav-section-header mt-2">
            <span class="nav-section-label">ASSETS</span>
        </div>
        <NavLink class="nav-link" href="/assets">
            <i class="bi bi-grid-3x3-gap me-2"></i>Assets
        </NavLink>

        @* ── DEFI ── *@
        <div class="nav-section-header mt-2">
            <span class="nav-section-label">DEFI</span>
        </div>
        <NavLink class="nav-link" href="/qx">
            <i class="bi bi-shop me-2"></i>QX Trading
        </NavLink>
        <NavLink class="nav-link" href="/qswap">
            <i class="bi bi-arrow-left-right me-2"></i>QSwap
        </NavLink>
        <NavLink class="nav-link" href="/qearn">
            <i class="bi bi-piggy-bank me-2"></i>QEarn
        </NavLink>
        <NavLink class="nav-link" href="/msvault">
            <i class="bi bi-safe me-2"></i>MSVault
        </NavLink>

        @* ── HISTORY ── *@
        <div class="nav-section-header mt-2">
            <span class="nav-section-label">HISTORY</span>
        </div>
        <NavLink class="nav-link" href="/history">
            <i class="bi bi-list-ul me-2"></i>Tx History
        </NavLink>
        <NavLink class="nav-link" href="/logs">
            <i class="bi bi-journal-text me-2"></i>Log Events
        </NavLink>
        @if (Backend.ActiveBackend == QueryBackend.Bob)
        {
            <NavLink class="nav-link" href="/transfers">
                <i class="bi bi-clock-history me-2"></i>Transfers
            </NavLink>
        }

        @* ── TOOLS ── *@
        <div class="nav-section-header mt-2">
            <span class="nav-section-label">TOOLS</span>
        </div>
        <NavLink class="nav-link" href="/sign-verify">
            <i class="bi bi-pen me-2"></i>Sign / Verify
        </NavLink>

        <hr class="my-2" />
        <NavLink class="nav-link" href="/sync">
            <i class="bi bi-arrow-repeat me-2"></i>Sync Manager
        </NavLink>
        <NavLink class="nav-link" href="/settings">
            <i class="bi bi-gear me-2"></i>Settings
        </NavLink>
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        Seed.OnSeedChanged += OnSeedChanged;
    }

    private void OnSeedChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Seed.OnSeedChanged -= OnSeedChanged;
    }
}
